{
  "id": "mcp-c0HYTqTFtktCE3Fk",
  "name": "Alex AI Knowledge Base RAG Ingestion",
  "description": "Converted from n8n workflow: Alex AI Knowledge Base RAG Ingestion",
  "version": "1.0.0",
  "active": true,
  "nodes": [
    {
      "id": "f3d6a19a-25d8-40b5-b56a-aeffef55d410",
      "name": "Webhook Trigger",
      "type": "mcp.webhook",
      "originalType": "n8n-nodes-base.webhook",
      "position": [
        250,
        300
      ],
      "parameters": {
        "httpMethod": "POST",
        "path": "ingest-knowledge",
        "responseMode": "responseNode",
        "options": {}
      },
      "webhookInfo": {
        "path": "ingest-knowledge",
        "method": "POST",
        "responseMode": "responseNode",
        "note": "⚠️ WEBHOOK EXECUTION POINT: This webhook can be executed via MCP at /api/workflows/execute with webhook path"
      },
      "metadata": {
        "converted": true,
        "originalNode": "Webhook Trigger"
      }
    },
    {
      "id": "9acf927f-1fc8-4960-a50c-6640d2b315cc",
      "name": "Extract Payload",
      "type": "mcp.transform",
      "originalType": "n8n-nodes-base.set",
      "position": [
        450,
        300
      ],
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "extract-metadata",
              "name": "documents",
              "value": "={{ $json.documents }}",
              "type": "array"
            },
            {
              "id": "session-id",
              "name": "session_id",
              "value": "={{ $json.session_id }}",
              "type": "string"
            },
            {
              "id": "timestamp",
              "name": "timestamp",
              "value": "={{ new Date().toISOString() }}",
              "type": "string"
            }
          ]
        }
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Extract Payload"
      }
    },
    {
      "id": "16d2b534-da62-4469-823d-321fba6a0afc",
      "name": "Split Into Items",
      "type": "mcp.unknown",
      "originalType": "n8n-nodes-base.splitInBatches",
      "position": [
        650,
        300
      ],
      "parameters": {
        "fieldToSplitOut": "documents",
        "options": {}
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Split Into Items"
      }
    },
    {
      "id": "4525c9d2-00e2-4f53-829d-bc02691c33e9",
      "name": "Extract Document Metadata",
      "type": "mcp.transform",
      "originalType": "n8n-nodes-base.set",
      "position": [
        850,
        300
      ],
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "doc-title",
              "name": "title",
              "value": "={{ $json.title }}",
              "type": "string"
            },
            {
              "id": "doc-content",
              "name": "content",
              "value": "={{ $json.content }}",
              "type": "string"
            },
            {
              "id": "doc-tags",
              "name": "tags",
              "value": "={{ $json.tags }}",
              "type": "array"
            },
            {
              "id": "doc-date",
              "name": "date",
              "value": "={{ $json.date }}",
              "type": "string"
            },
            {
              "id": "doc-session",
              "name": "session",
              "value": "={{ $json.session }}",
              "type": "string"
            },
            {
              "id": "doc-score",
              "name": "anti_hallucination_score",
              "value": "={{ $json.anti_hallucination_score || 100 }}",
              "type": "number"
            },
            {
              "id": "doc-priority",
              "name": "priority",
              "value": "={{ $json.priority || 'medium' }}",
              "type": "string"
            }
          ]
        }
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Extract Document Metadata"
      }
    },
    {
      "id": "f10ce1b9-b570-4318-b799-565cee6698a8",
      "name": "Chunk Document",
      "type": "mcp.transform",
      "originalType": "n8n-nodes-base.function",
      "position": [
        1050,
        300
      ],
      "parameters": {
        "functionCode": "const text = $json.content || '';\\nconst chunkSize = 1000;\\nconst overlap = 200;\\nconst results = [];\\nfor (let i = 0; i < text.length; i += chunkSize - overlap) {\\n  const chunk = text.slice(i, i + chunkSize);\\n  results.push({ json: { ...$json, chunk, chunk_index: results.length }});\\n}\\nreturn results;"
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Chunk Document"
      }
    },
    {
      "id": "f36783bb-7677-497d-bac8-5232b0dbb22e",
      "name": "Generate OpenAI Embeddings",
      "type": "mcp.unknown",
      "originalType": "n8n-nodes-base.openAi",
      "position": [
        1250,
        300
      ],
      "parameters": {
        "resource": "embeddings",
        "operation": "create",
        "model": "text-embedding-3-small",
        "input": "={{ $json.chunk }}"
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Generate OpenAI Embeddings"
      }
    },
    {
      "id": "7ac46764-46a4-4e77-9020-c77b73ff02cc",
      "name": "Extract Embedding",
      "type": "mcp.transform",
      "originalType": "n8n-nodes-base.set",
      "position": [
        1450,
        180
      ],
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "embedding",
              "name": "embedding",
              "value": "={{ $json.data[0].embedding }}",
              "type": "array"
            }
          ]
        }
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Extract Embedding"
      }
    },
    {
      "id": "218e3211-9271-49ae-a95d-9da24fee34d9",
      "name": "Store in Supabase",
      "type": "mcp.database",
      "originalType": "n8n-nodes-base.supabase",
      "position": [
        1450,
        300
      ],
      "parameters": {
        "operation": "insert",
        "table": "knowledge_base",
        "columns": {
          "mappings": [
            {
              "column": "title",
              "value": "={{ $json.title }}"
            },
            {
              "column": "content",
              "value": "={{ $json.chunk }}"
            },
            {
              "column": "embedding",
              "value": "={{ $json.embedding }}"
            },
            {
              "column": "metadata",
              "value": "={{ JSON.stringify({ tags: $json.tags, date: $json.date, session: $json.session, priority: $json.priority, anti_hallucination_score: $json.anti_hallucination_score, chunk_index: $json.chunk_index }) }}"
            },
            {
              "column": "session_id",
              "value": "={{ $('Extract Payload').item.json.session_id }}"
            },
            {
              "column": "created_at",
              "value": "={{ new Date().toISOString() }}"
            }
          ]
        }
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Store in Supabase"
      }
    },
    {
      "id": "08d7f7b8-560d-46a9-94ca-884a51ecc3ce",
      "name": "Check for Errors",
      "type": "mcp.logic",
      "originalType": "n8n-nodes-base.if",
      "position": [
        1650,
        300
      ],
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check-error",
              "leftValue": "={{ $json.error }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Check for Errors"
      }
    },
    {
      "id": "6f963ee7-ccec-464b-a487-4d7f961302b3",
      "name": "Log Error",
      "type": "mcp.database",
      "originalType": "n8n-nodes-base.supabase",
      "position": [
        1850,
        200
      ],
      "parameters": {
        "operation": "insert",
        "table": "rag_ingestion_log",
        "columns": {
          "mappings": [
            {
              "column": "session_id",
              "value": "={{ $('Extract Payload').item.json.session_id }}"
            },
            {
              "column": "status",
              "value": "error"
            },
            {
              "column": "error_message",
              "value": "={{ $json.error }}"
            },
            {
              "column": "document_title",
              "value": "={{ $json.title }}"
            },
            {
              "column": "timestamp",
              "value": "={{ new Date().toISOString() }}"
            }
          ]
        }
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Log Error"
      }
    },
    {
      "id": "7edc5477-a505-4bc0-852e-875289ed5767",
      "name": "Log Success",
      "type": "mcp.database",
      "originalType": "n8n-nodes-base.supabase",
      "position": [
        1850,
        400
      ],
      "parameters": {
        "operation": "insert",
        "table": "rag_ingestion_log",
        "columns": {
          "mappings": [
            {
              "column": "session_id",
              "value": "={{ $('Extract Payload').item.json.session_id }}"
            },
            {
              "column": "status",
              "value": "success"
            },
            {
              "column": "document_title",
              "value": "={{ $json.title }}"
            },
            {
              "column": "chunks_created",
              "value": "={{ $json.chunk_index + 1 }}"
            },
            {
              "column": "timestamp",
              "value": "={{ new Date().toISOString() }}"
            }
          ]
        }
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Log Success"
      }
    },
    {
      "id": "f88b0c76-6d6a-4f80-a711-1f3f8eb1c37a",
      "name": "Prepare Response",
      "type": "mcp.transform",
      "originalType": "n8n-nodes-base.set",
      "position": [
        2050,
        300
      ],
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "response-success",
              "name": "success",
              "value": "true",
              "type": "boolean"
            },
            {
              "id": "response-message",
              "name": "message",
              "value": "Knowledge base updated successfully",
              "type": "string"
            },
            {
              "id": "response-session",
              "name": "session_id",
              "value": "={{ $('Extract Payload').item.json.session_id }}",
              "type": "string"
            },
            {
              "id": "response-timestamp",
              "name": "timestamp",
              "value": "={{ new Date().toISOString() }}",
              "type": "string"
            }
          ]
        }
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Prepare Response"
      }
    },
    {
      "id": "d8bb4b30-2a33-447c-9cc8-2c8a54260813",
      "name": "Webhook Response",
      "type": "mcp.response",
      "originalType": "n8n-nodes-base.respondToWebhook",
      "position": [
        2250,
        300
      ],
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "webhookInfo": null,
      "metadata": {
        "converted": true,
        "originalNode": "Webhook Response"
      }
    }
  ],
  "edges": [
    {
      "id": "edge-Webhook Trigger-Extract Payload",
      "source": "Webhook Trigger",
      "target": "Extract Payload",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Extract Payload-Split Into Items",
      "source": "Extract Payload",
      "target": "Split Into Items",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Split Into Items-Extract Document Metadata",
      "source": "Split Into Items",
      "target": "Extract Document Metadata",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Extract Document Metadata-Chunk Document",
      "source": "Extract Document Metadata",
      "target": "Chunk Document",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Chunk Document-Generate OpenAI Embeddings",
      "source": "Chunk Document",
      "target": "Generate OpenAI Embeddings",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Generate OpenAI Embeddings-Extract Embedding",
      "source": "Generate OpenAI Embeddings",
      "target": "Extract Embedding",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Extract Embedding-Store in Supabase",
      "source": "Extract Embedding",
      "target": "Store in Supabase",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Store in Supabase-Check for Errors",
      "source": "Store in Supabase",
      "target": "Check for Errors",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Check for Errors-Log Error",
      "source": "Check for Errors",
      "target": "Log Error",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Check for Errors-Log Success",
      "source": "Check for Errors",
      "target": "Log Success",
      "sourceHandle": "main-1",
      "targetHandle": "input"
    },
    {
      "id": "edge-Log Error-Prepare Response",
      "source": "Log Error",
      "target": "Prepare Response",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Log Success-Prepare Response",
      "source": "Log Success",
      "target": "Prepare Response",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    },
    {
      "id": "edge-Prepare Response-Webhook Response",
      "source": "Prepare Response",
      "target": "Webhook Response",
      "sourceHandle": "main-0",
      "targetHandle": "input"
    }
  ],
  "webhookExecutionPoints": [
    {
      "nodeId": "f3d6a19a-25d8-40b5-b56a-aeffef55d410",
      "nodeName": "Webhook Trigger",
      "webhookPath": "ingest-knowledge",
      "webhookMethod": "POST",
      "mcpExecutionPath": "/api/workflows/execute?webhook=ingest-knowledge",
      "note": "⚠️ WEBHOOK EXECUTION POINT: This webhook can be executed via MCP at /api/workflows/execute with webhook path"
    }
  ],
  "metadata": {
    "originalWorkflowId": "c0HYTqTFtktCE3Fk",
    "convertedAt": "2025-11-21T14:24:04.678Z",
    "originalName": "Alex AI Knowledge Base RAG Ingestion"
  }
}