{
  "name": "Supabase Schema Setup",
  "description": "Migrated from n8n",
  "steps": [
    {
      "id": "a6935241-dad2-4f19-a4e3-485830bff411",
      "type": "workflowExecute",
      "config": {
        "name": "Webhook Trigger",
        "parameters": {
          "path": "supabase-schema-setup",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "position": [
          250,
          300
        ],
        "originalType": "n8n-nodes-base.webhook"
      },
      "next": [
        "Validate Admin Key"
      ]
    },
    {
      "id": "04642a84-dcce-4d09-94cb-569baea430c6",
      "type": "transform",
      "config": {
        "name": "Validate Admin Key",
        "parameters": {
          "conditions": {
            "string": [
              {
                "value1": "={{$json.headers['x-admin-key']}}",
                "value2": "={{$env.ADMIN_SETUP_KEY}}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.if",
        "position": [
          450,
          300
        ],
        "originalType": "n8n-nodes-base.if"
      },
      "next": [
        "Create Main Table",
        "Response Unauthorized"
      ]
    },
    {
      "id": "0fc5aad6-7c74-441c-b648-08e0b71bb21e",
      "type": "supabaseQuery",
      "config": {
        "name": "Create Main Table",
        "parameters": {
          "operation": "executeQuery",
          "query": "-- Create project_content table\nCREATE TABLE IF NOT EXISTS project_content (\n  project_id TEXT PRIMARY KEY,\n  headline TEXT NOT NULL,\n  subheadline TEXT,\n  description TEXT,\n  theme TEXT DEFAULT 'gradient',\n  business_type TEXT,\n  components JSONB DEFAULT '[]'::jsonb,\n  pages JSONB DEFAULT '{}'::jsonb,\n  updated_at BIGINT NOT NULL,\n  synced_at TIMESTAMPTZ DEFAULT NOW(),\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  version INTEGER DEFAULT 1,\n  deleted_at TIMESTAMPTZ DEFAULT NULL\n);",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "position": [
          650,
          200
        ],
        "originalType": "n8n-nodes-base.postgres"
      },
      "next": [
        "Create Indexes"
      ]
    },
    {
      "id": "cc29fd73-fa6f-42de-a491-06f3547f1377",
      "type": "supabaseQuery",
      "config": {
        "name": "Create Indexes",
        "parameters": {
          "operation": "executeQuery",
          "query": "-- Create indexes\nCREATE INDEX IF NOT EXISTS idx_project_content_updated_at ON project_content(updated_at DESC);\nCREATE INDEX IF NOT EXISTS idx_project_content_synced_at ON project_content(synced_at DESC);\nCREATE INDEX IF NOT EXISTS idx_project_content_business_type ON project_content(business_type);\nCREATE INDEX IF NOT EXISTS idx_project_content_theme ON project_content(theme);\nCREATE INDEX IF NOT EXISTS idx_project_content_deleted_at ON project_content(deleted_at) WHERE deleted_at IS NULL;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "position": [
          850,
          200
        ],
        "originalType": "n8n-nodes-base.postgres"
      },
      "next": [
        "Create Changelog"
      ]
    },
    {
      "id": "ae4ec274-026b-4a6e-aa8e-ea9827dd9cd7",
      "type": "supabaseQuery",
      "config": {
        "name": "Create Changelog",
        "parameters": {
          "operation": "executeQuery",
          "query": "-- Create changelog table\nCREATE TABLE IF NOT EXISTS project_content_changelog (\n  id BIGSERIAL PRIMARY KEY,\n  project_id TEXT NOT NULL,\n  action TEXT NOT NULL,\n  changed_fields JSONB,\n  old_values JSONB,\n  new_values JSONB,\n  source TEXT DEFAULT 'dashboard',\n  user_agent TEXT,\n  ip_address INET,\n  changed_at TIMESTAMPTZ DEFAULT NOW()\n);\n\nCREATE INDEX IF NOT EXISTS idx_changelog_project_id ON project_content_changelog(project_id);\nCREATE INDEX IF NOT EXISTS idx_changelog_changed_at ON project_content_changelog(changed_at DESC);",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "position": [
          1050,
          200
        ],
        "originalType": "n8n-nodes-base.postgres"
      },
      "next": [
        "Setup RLS"
      ]
    },
    {
      "id": "60d90017-5eee-494f-bb68-16f5d701efb2",
      "type": "supabaseQuery",
      "config": {
        "name": "Setup RLS",
        "parameters": {
          "operation": "executeQuery",
          "query": "-- Enable RLS\nALTER TABLE project_content ENABLE ROW LEVEL SECURITY;\n\n-- Create policy for service role\nDROP POLICY IF EXISTS \"Allow n8n service role full access\" ON project_content;\nCREATE POLICY \"Allow n8n service role full access\"\n  ON project_content\n  FOR ALL\n  TO service_role\n  USING (true)\n  WITH CHECK (true);",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "position": [
          1250,
          200
        ],
        "originalType": "n8n-nodes-base.postgres"
      },
      "next": [
        "Response Success"
      ]
    },
    {
      "id": "b56d9bbb-88fd-42d3-b014-5064df1d6b4b",
      "type": "transform",
      "config": {
        "name": "Response Success",
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ { \"success\": true, \"message\": \"Supabase schema created successfully\", \"tables\": [\"project_content\", \"project_content_changelog\"], \"timestamp\": $now } }}"
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "position": [
          1450,
          200
        ],
        "originalType": "n8n-nodes-base.respondToWebhook"
      }
    },
    {
      "id": "880d8dc9-2773-494f-be80-7ab121f89f18",
      "type": "transform",
      "config": {
        "name": "Response Unauthorized",
        "parameters": {
          "respondWith": "json",
          "responseCode": 403,
          "responseBody": "={{ { \"success\": false, \"error\": \"Unauthorized: Invalid admin key\" } }}"
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "position": [
          650,
          400
        ],
        "originalType": "n8n-nodes-base.respondToWebhook"
      }
    }
  ],
  "metadata": {
    "originalId": "JfqWZUw0gU4n1Oft",
    "originalName": "Supabase Schema Setup",
    "migratedAt": "2025-11-21T11:19:39.209Z",
    "source": "n8n"
  },
  "id": "mcp-1763723979209-j5ys7q",
  "createdAt": "2025-11-21T11:19:39.209Z",
  "updatedAt": "2025-11-21T11:19:39.209Z"
}