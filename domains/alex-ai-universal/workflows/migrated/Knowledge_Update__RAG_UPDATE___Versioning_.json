{
  "name": "Knowledge Update (RAG UPDATE - Versioning)",
  "description": "v1",
  "steps": [
    {
      "id": "webhook-trigger",
      "type": "workflowExecute",
      "config": {
        "name": "Webhook Trigger",
        "parameters": {
          "httpMethod": "POST",
          "path": "knowledge-update",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "position": [
          250,
          300
        ],
        "originalType": "n8n-nodes-base.webhook"
      },
      "next": [
        "Validate Update"
      ]
    },
    {
      "id": "validate-update",
      "type": "transform",
      "config": {
        "name": "Validate Update",
        "parameters": {
          "functionCode": "// Validate update request and prepare versioned update\nconst body = $input.item.json.body;\n\nif (!body.session_id) {\n  throw new Error('session_id is required for updates');\n}\n\n// Build update data\nconst updateData = {\n  session_id: body.session_id,\n  \n  // Fields that can be updated\n  title: body.title,\n  executive_summary: body.executive_summary,\n  category: body.category,\n  \n  // Append-only fields (merge with existing)\n  additional_decisions: body.additional_decisions,\n  additional_patterns: body.additional_patterns,\n  additional_insights: body.additional_insights,\n  \n  // Metadata\n  update_reason: body.update_reason || 'Manual update',\n  updated_by: body.updated_by || 'system',\n  updated_at: new Date().toISOString()\n};\n\nconsole.log('üìù Updating knowledge:', updateData.session_id, '| Reason:', updateData.update_reason);\n\nreturn { json: updateData };"
        },
        "type": "n8n-nodes-base.function",
        "position": [
          450,
          300
        ],
        "originalType": "n8n-nodes-base.function"
      },
      "next": [
        "Supabase Update"
      ]
    },
    {
      "id": "supabase-update",
      "type": "supabaseQuery",
      "config": {
        "name": "Supabase Update",
        "parameters": {
          "operation": "update",
          "table": "knowledge_base",
          "columns": "title,executive_summary,category,updated_at",
          "filters": {
            "conditions": [
              {
                "column": "session_id",
                "condition": "equals",
                "value": "={{ $json.session_id }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "position": [
          650,
          300
        ],
        "originalType": "n8n-nodes-base.supabase"
      },
      "next": [
        "Response Success"
      ]
    },
    {
      "id": "response-success",
      "type": "transform",
      "config": {
        "name": "Response Success",
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ { \"success\": true, \"session_id\": $json.session_id, \"message\": \"Knowledge updated successfully\", \"timestamp\": $now } }}",
          "options": {
            "responseCode": 200,
            "responseHeaders": {
              "entries": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            }
          }
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "position": [
          850,
          300
        ],
        "originalType": "n8n-nodes-base.respondToWebhook"
      }
    }
  ],
  "metadata": {
    "originalId": "aIj0j8QYvaYyGhJj",
    "originalName": "Knowledge Update (RAG UPDATE - Versioning)",
    "migratedAt": "2025-11-21T11:19:39.212Z",
    "source": "n8n"
  },
  "id": "mcp-1763723979212-2eqeko",
  "createdAt": "2025-11-21T11:19:39.212Z",
  "updatedAt": "2025-11-21T11:19:39.212Z"
}